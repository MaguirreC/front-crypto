<div class="dashboard-container">
  <!-- Alerta -->
  @if (showAlert) {
  <div class="alert-overlay">
    <div
      class="alert"
      [class.alert-success]="alertType === 'success'"
      [class.alert-error]="alertType === 'error'"
      [class.alert-info]="alertType === 'info'"
    >
      <div class="alert-content">
        <span class="alert-icon">
          @if (alertType === 'success') { ‚úÖ } @if (alertType === 'error') { ‚ùå } @if (alertType ===
          'info') { ‚ÑπÔ∏è }
        </span>
        <p class="alert-message">{{ alertMessage }}</p>
      </div>
      <button class="alert-close" (click)="closeAlert()">‚úï</button>
    </div>
  </div>
  }

  <!-- Loader de sincronizaci√≥n -->
  @if (syncing) {
  <div class="sync-loader-overlay">
    <div class="sync-loader">
      <div class="spinner-large"></div>
      <p>Sincronizando datos...</p>
      <small>Esto puede tomar unos momentos</small>
    </div>
  </div>
  }

  <!-- Navbar -->
  <nav class="navbar">
    <h1>ü™ô Crypto Collector</h1>
    <div class="user-section">
      <span
        >Bienvenido, <strong>{{ username }}</strong></span
      >
      <button class="btn-logout" (click)="onLogout()">Cerrar Sesi√≥n</button>
    </div>
  </nav>

  <!-- Contenido principal -->
  <div class="content">
    <!-- Barra de acciones -->
    <div class="actions-bar">
      <div class="search-box">
        <input
          type="text"
          [(ngModel)]="searchTerm"
          (keyup.enter)="onSearch()"
          placeholder="Buscar por nombre o s√≠mbolo..."
          class="search-input"
        />
        <button (click)="onSearch()" class="btn-search">üîç Buscar</button>
        <button (click)="toggleFilters()" class="btn-filter">
          {{ showFilters ? 'üîº Ocultar Filtros' : 'üîΩ Filtros Avanzados' }}
        </button>
      </div>

      <button (click)="onSync()" [disabled]="syncing" class="btn-sync">
        @if (syncing) {
        <span>‚è≥ Sincronizando...</span>
        } @else {
        <span>üîÑ Sincronizar Datos</span>
        }
      </button>
    </div>

    <!-- Filtros avanzados -->
    @if (showFilters) {
    <div class="filters-panel">
      <div class="filter-row">
        <div class="filter-group">
          <label>Precio M√≠nimo</label>
          <input
            type="text"
            [value]="minPriceDisplay"
            (input)="onMinPriceChange($any($event.target).value)"
            placeholder="0"
            class="filter-input"
          />
        </div>
        <div class="filter-group">
          <label>Precio M√°ximo</label>
          <input
            type="text"
            [value]="maxPriceDisplay"
            (input)="onMaxPriceChange($any($event.target).value)"
            placeholder="0"
            class="filter-input"
          />
        </div>
        <div class="filter-group">
          <label>Market Cap M√≠nimo</label>
          <input
            type="text"
            [value]="minMarketCapDisplay"
            (input)="onMinMarketCapChange($any($event.target).value)"
            placeholder="0"
            class="filter-input"
          />
        </div>
        <div class="filter-group">
          <label>Market Cap M√°ximo</label>
          <input
            type="text"
            [value]="maxMarketCapDisplay"
            (input)="onMaxMarketCapChange($any($event.target).value)"
            placeholder="0"
            class="filter-input"
          />
        </div>
      </div>
      <div class="filter-actions">
        <button (click)="onApplyFilters()" class="btn-apply">Aplicar Filtros</button>
        <button (click)="onClearFilters()" class="btn-clear">Limpiar Filtros</button>
      </div>
    </div>
    }

    <!-- Tabla de criptomonedas -->
    @if (loading) {
    <div class="loading">
      <div class="spinner"></div>
      <p>Cargando criptomonedas...</p>
    </div>
    } @else if (cryptos.length === 0) {
    <div class="no-data">
      <p>No hay datos disponibles</p>
      <p>Presiona "Sincronizar Datos" para cargar informaci√≥n</p>
    </div>
    } @else {
    <div class="table-container">
      <table class="crypto-table">
        <thead>
          <tr>
            <th>#</th>
            <th (click)="onSort('name')" class="sortable">
              Nombre @if (sortBy === 'name') {
              <span class="sort-icon">{{ sortDirection === 'asc' ? '‚Üë' : '‚Üì' }}</span>
              }
            </th>
            <th (click)="onSort('symbol')" class="sortable">
              S√≠mbolo @if (sortBy === 'symbol') {
              <span class="sort-icon">{{ sortDirection === 'asc' ? '‚Üë' : '‚Üì' }}</span>
              }
            </th>
            <th (click)="onSort('priceUsd')" class="sortable">
              Precio USD @if (sortBy === 'priceUsd') {
              <span class="sort-icon">{{ sortDirection === 'asc' ? '‚Üë' : '‚Üì' }}</span>
              }
            </th>
            <th (click)="onSort('priceChange24h')" class="sortable">
              Cambio 24h @if (sortBy === 'priceChange24h') {
              <span class="sort-icon">{{ sortDirection === 'asc' ? '‚Üë' : '‚Üì' }}</span>
              }
            </th>
            <th (click)="onSort('marketCap')" class="sortable">
              Market Cap @if (sortBy === 'marketCap') {
              <span class="sort-icon">{{ sortDirection === 'asc' ? '‚Üë' : '‚Üì' }}</span>
              }
            </th>
            <th (click)="onSort('volume24h')" class="sortable">
              Volumen 24h @if (sortBy === 'volume24h') {
              <span class="sort-icon">{{ sortDirection === 'asc' ? '‚Üë' : '‚Üì' }}</span>
              }
            </th>
            <th>High 24h</th>
            <th>Low 24h</th>
          </tr>
        </thead>
        <tbody>
          @for (crypto of cryptos; track crypto.id) {
          <tr>
            <td>{{ crypto.id }}</td>
            <td class="crypto-name">{{ crypto.name }}</td>
            <td class="crypto-symbol">{{ crypto.symbol | uppercase }}</td>
            <td class="price">${{ crypto.priceUsd | number : '1.2-8' }}</td>
            <td
              [class.positive]="crypto.priceChange24h > 0"
              [class.negative]="crypto.priceChange24h < 0"
            >
              {{ crypto.priceChange24h | number : '1.2-4' }}%
            </td>
            <td>${{ crypto.marketCap | number : '1.0-0' }}</td>
            <td>${{ crypto.volume24h | number : '1.0-0' }}</td>
            <td class="positive">${{ crypto.high24h | number : '1.2-8' }}</td>
            <td class="negative">${{ crypto.low24h | number : '1.2-8' }}</td>
          </tr>
          }
        </tbody>
      </table>
    </div>

    <!-- Paginaci√≥n -->
    <div class="pagination">
      <button
        (click)="onPageChange(currentPage - 1)"
        [disabled]="currentPage === 0"
        class="btn-page"
      >
        Anterior
      </button>

      <span class="page-info">
        P√°gina {{ currentPage + 1 }} de {{ totalPages }} ({{ totalElements }} registros)
      </span>

      <button
        (click)="onPageChange(currentPage + 1)"
        [disabled]="currentPage >= totalPages - 1"
        class="btn-page"
      >
        Siguiente
      </button>
    </div>
    }
  </div>
</div>
